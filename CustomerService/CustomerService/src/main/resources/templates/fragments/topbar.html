<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<!-- Top Bar -->
<div class="top-bar" th:fragment="topbar">
    <div class="top-bar-content">
        <div class="top-nav">
            <a href="/home"><i class="fas fa-home"></i> TRANG CHỦ</a>
            <a href="/login"><i class="fas fa-sign-in-alt"></i> ĐĂNG NHẬP</a>
            <a href="/register"><i class="fas fa-user-plus"></i> ĐĂNG KÝ</a>
            <a href="#contact"><i class="fas fa-phone"></i> LIÊN HỆ</a>
        </div>
        <div class="top-actions">
            <a href="/dashboard"><i class="fas fa-user"></i> TÀI KHOẢN</a>
            <a href="/cart"><i class="fas fa-shopping-cart"></i> GIỎ HÀNG <span id="cartCount" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 11px; margin-left: 5px; font-weight: bold; display: none;">0</span></a>
        </div>
    </div>
    
    <!-- Cart Count Update Script -->
    <script th:inline="javascript">
        (function() {
            // Initialize cart count on page load
            updateCartCountBadge();
            
            // Update cart count when page becomes visible (user switches tabs)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    updateCartCountBadge();
                }
            });
            
            // Auto-refresh cart count every 10 seconds
            setInterval(updateCartCountBadge, 10000);
            
            /**
             * Update the cart count badge
             */
            async function updateCartCountBadge() {
                try {
                    const response = await fetch('/api/cart/count', {
                        method: 'GET',
                        credentials: 'same-origin'
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        
                        if (result.success) {
                            const cartCountElement = document.getElementById('cartCount');
                            if (cartCountElement) {
                                const count = result.data || 0;
                                cartCountElement.textContent = count;
                                
                                // Show or hide the badge based on count
                                if (count > 0) {
                                    cartCountElement.style.display = 'inline-block';
                                } else {
                                    cartCountElement.style.display = 'none';
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error updating cart count:', error);
                    // Hide badge on error
                    const cartCountElement = document.getElementById('cartCount');
                    if (cartCountElement) {
                        cartCountElement.style.display = 'none';
                    }
                }
            }
            
            // Make function available globally for other scripts to call
            window.updateCartCount = updateCartCountBadge;
        })();
    </script>
</div>
</body>
</html>

